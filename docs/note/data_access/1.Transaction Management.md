# 1. 事务管理

Spring框架为事务管理提供了一致性的抽象，具有以下优点：

* 跨不同事务API的一致性编程模型，例如Java Transaction API(JTA)，JDBC，Hibernate，Java Persistence API(JPA)。

* 提供声明式事务管理。

* 为编程事务管理提供比复杂事务管理API（例如JTA）更简单的API。

* 与Spring的数据访问抽象的出色集成。



以下部分描述了Spring框架的事务特性和技术：

* Spring框架事务支持模型的优点：描述了为什么可以使用Spring框架事务抽象来代替EJB容器管理事务或选择通过专用API驱动本地事务 ，例如Hibernate。

* 理解Spring框架的事务抽象：列出核心类，并描述如何配置并从多种源中获取`DataSource`实例。

* 将资源与事务同步：描述了应用程序代码如何确保正确创建、重用和清理资源。

* 声明式事务管理：描述了对声明式事务的支持。

* 编程事务管理：涵盖可编程的支持。

* 事务绑定事件：描述了如何在事务中使用应用程序事件。



## 1.1. Spring框架事务支持模型的优点

传统上，Java EE开发者对于事务管理来说有两个选择：全局或本地事务，两者都有很大的局限性。下节将回顾全局和本地事务管理类，随后讨论Spring框架事务管理如何解决全局和本地事务模型的局限性。



### 1.1.1. 全局事务

全局事务可以让用户使用多种事务资源，通常是关系型数据库和消息队列。应用程序服务通过JTA管理全局事务，它很繁琐（部分是由于异常模型）。此外，JTA `UserTransaction`通常来源于JNDI，这意味着还需要使用JNDI才能使用JTA。全局事务的使用限制了任何应用程序代码的潜在的重用能力，因为JTA通常仅在应用欧冠程序服务环境中可用。



以前，使用全局事务的首选方法是通过EJB CMT(Container Managed Transaction)。CMT是声明式事务管理的一种形式（与程序性事务管理不同）。EJB CMT移除了与事务相关的JNDI查找需要，尽管使用EJB本身需要JNDI。它消除了大多数但不是全部的通过Java代码来控制事务的需要。一个重要的缺点是，CMT与JTA和应用程序服务器环境相关联。此外，如果选择使用EJBs实现业务逻辑，它是唯一可用的。通常，EJB的缺点很大，以至于这不是一个有吸引力的提议，特别是面对声明式事务管理的强制选择时。



### 1.1.2. 本地事务

本地事务是特殊的资源，例如与JDBC相关连的事务。本地事务可能使用更简单，但是有一个重要的缺点：他们不能在跨多个事务资源上工作。例如，使用JDBC连接管理的事务代码不能在全局JTA事务中运行。因为应用服务器不参与事务管理，它不能确保多个资源之间的正确性。（值得注意的是，大多数应用程序使用单个事务资源。）另一个缺点是本地事务对编程模型具有侵入性。



### 1.1.3. Spring框架的一致性事务模型

Spring解决了全局和本地事务的缺点。它让开发者能在任何环境中使用一致的编程模型。只需要写一次代码，就可以从不同环境中的不同事务策略中受益。Spring提供声明和编程事务管理。多数用户更喜欢声明式事务管理，这也是在多数情况下建议使用的。



通过编程事务管理，开发人员可以使用Spring框架事务抽象，该抽象可以在任何基于事务基础框架下正常工作。使用首选的声明式事务模型，开发人员通常只编写很少或不用编写与事务相关的代码。因此，他们不依赖于Spring框架的事务API或任何其他事务API。



> **需要应用服务器来管理事务吗？**
> 
> 当企业级Java应用程序需要应用服务器时，Spring框架事务挂你支持更改传统规则。
> 
> 特别是，不需要纯粹用于通过EJB进行声明式事务的应用程序服务器。实际上，即使应用程序服务器具有强大的JTA功能，也可能会决定，与EJB CMT相比，Spring框架的声明式事务提供了更强大和更搞笑的编程模型。
> 
> 通常，仅当应用程序需要处理跨多个资源的事务时，才需要应用程序服务器的JTA功能，而这并不是多数应用程序所必须的。许多高端应用程序使用单个高度可扩展的数据库（例如，Oracle RAC）来代替。独立事务管理（例如Atomikos Transactions和JOTM）是可选的。当然，可能需要其他应用程序服务器功能，例如Java Message Service(JMS)和Java EE Connector Architecture(JCA)。
> 
> Spring框架是用户可以选择合适将应用程序扩展到完全加载的应用程序服务器。不再使用EJB CMT或JTA的唯一选择是使用本地事务编写代码（例如JDBC连接上的事务），并且如果需要让代码在全局的容器管理的事务中运行，则面临大量的返工。使用Spring框架，仅需要更改配置文件中某些bean定义（而不是代码）。



## 1.2. 理解Spring框架的事务抽象

Spring事务抽象的关键是事务策略的概念。事务策略通过`Transactionmanager`定义，特别是用于命令式事务管理的`org.springframework.transaction.PlatformTransactionManager`接口和用于反应式事务管理的`org.springframework.transaction.ReactiveTransactionManager`接口。下面列出了`PlatformTransactionManager`API：

```java

```


